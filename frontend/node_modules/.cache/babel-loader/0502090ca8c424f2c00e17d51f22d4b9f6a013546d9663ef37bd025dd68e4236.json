{"ast":null,"code":"var _s = $RefreshSig$();\n/**\n * RequireAuth Component\n * \n * Higher-order component that protects routes by:\n * - Checking for token presence\n * - Validating user role against allowed roles\n * - Redirecting to login/unauthorized based on validation\n */\n\nimport React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport toast from 'react-hot-toast';\nimport { Fragment as _Fragment, jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RequireAuth = ({\n  children,\n  allowedRoles\n}) => {\n  _s();\n  const navigate = useNavigate();\n  useEffect(() => {\n    const validateAccess = () => {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        toast.error('Please log in to continue');\n        navigate('/login');\n        return;\n      }\n\n      // Role validation (if roles are specified)\n      if (allowedRoles && allowedRoles.length > 0) {\n        try {\n          // Decode JWT payload (assumes token is in format: header.payload.signature)\n          const payload = token.split('.')[1];\n          const decodedPayload = JSON.parse(atob(payload));\n\n          // Check if user's role is allowed\n          if (!allowedRoles.includes(decodedPayload.role)) {\n            toast.error('Access Denied — You do not have permission to view this page.');\n            navigate('/unauthorized');\n            return;\n          }\n\n          // Check token expiration\n          if (decodedPayload.exp * 1000 < Date.now()) {\n            toast.error('Your session has expired. Please log in again.');\n            localStorage.removeItem('token');\n            navigate('/login');\n            return;\n          }\n        } catch (error) {\n          console.error('Error validating token:', error);\n          toast.error('Authentication error. Please log in again.');\n          localStorage.removeItem('token');\n          navigate('/login');\n          return;\n        }\n      }\n    };\n    validateAccess();\n  }, [navigate, allowedRoles]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: children\n  }, void 0, false);\n};\n_s(RequireAuth, \"0pNeyzXk/ByIxyERsdaIrG6js9s=\", false, function () {\n  return [useNavigate];\n});\n_c = RequireAuth;\nexport default RequireAuth;\nvar _c;\n$RefreshReg$(_c, \"RequireAuth\");","map":{"version":3,"names":["React","useEffect","useNavigate","toast","Fragment","_Fragment","jsxDEV","_jsxDEV","RequireAuth","children","allowedRoles","_s","navigate","validateAccess","token","localStorage","getItem","error","length","payload","split","decodedPayload","JSON","parse","atob","includes","role","exp","Date","now","removeItem","console","_c","$RefreshReg$"],"sources":["/Users/tobe/Documents/Workshop/Shortlet/frontend/src/components/RequireAuth.tsx"],"sourcesContent":["/**\n * RequireAuth Component\n * \n * Higher-order component that protects routes by:\n * - Checking for token presence\n * - Validating user role against allowed roles\n * - Redirecting to login/unauthorized based on validation\n */\n\nimport React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport toast from 'react-hot-toast';\n\ninterface RequireAuthProps {\n  children: React.ReactNode;\n  allowedRoles?: string[];\n}\n\ninterface JWTPayload {\n  id: number;\n  role: string;\n  exp: number;\n}\n\nconst RequireAuth: React.FC<RequireAuthProps> = ({ children, allowedRoles }) => {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const validateAccess = () => {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        toast.error('Please log in to continue');\n        navigate('/login');\n        return;\n      }\n\n      // Role validation (if roles are specified)\n      if (allowedRoles && allowedRoles.length > 0) {\n        try {\n          // Decode JWT payload (assumes token is in format: header.payload.signature)\n          const payload = token.split('.')[1];\n          const decodedPayload = JSON.parse(atob(payload)) as JWTPayload;\n\n          // Check if user's role is allowed\n          if (!allowedRoles.includes(decodedPayload.role)) {\n            toast.error('Access Denied — You do not have permission to view this page.');\n            navigate('/unauthorized');\n            return;\n          }\n\n          // Check token expiration\n          if (decodedPayload.exp * 1000 < Date.now()) {\n            toast.error('Your session has expired. Please log in again.');\n            localStorage.removeItem('token');\n            navigate('/login');\n            return;\n          }\n        } catch (error) {\n          console.error('Error validating token:', error);\n          toast.error('Authentication error. Please log in again.');\n          localStorage.removeItem('token');\n          navigate('/login');\n          return;\n        }\n      }\n    };\n\n    validateAccess();\n  }, [navigate, allowedRoles]);\n\n  return <>{children}</>;\n};\n\nexport default RequireAuth; "],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,KAAK,IAAIC,SAAS,QAAQ,OAAO;AACxC,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,OAAOC,KAAK,MAAM,iBAAiB;AAAC,SAAAC,QAAA,IAAAC,SAAA,EAAAC,MAAA,IAAAC,OAAA;AAapC,MAAMC,WAAuC,GAAGA,CAAC;EAAEC,QAAQ;EAAEC;AAAa,CAAC,KAAK;EAAAC,EAAA;EAC9E,MAAMC,QAAQ,GAAGV,WAAW,CAAC,CAAC;EAE9BD,SAAS,CAAC,MAAM;IACd,MAAMY,cAAc,GAAGA,CAAA,KAAM;MAC3B,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;MAC3C,IAAI,CAACF,KAAK,EAAE;QACVX,KAAK,CAACc,KAAK,CAAC,2BAA2B,CAAC;QACxCL,QAAQ,CAAC,QAAQ,CAAC;QAClB;MACF;;MAEA;MACA,IAAIF,YAAY,IAAIA,YAAY,CAACQ,MAAM,GAAG,CAAC,EAAE;QAC3C,IAAI;UACF;UACA,MAAMC,OAAO,GAAGL,KAAK,CAACM,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;UACnC,MAAMC,cAAc,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACL,OAAO,CAAC,CAAe;;UAE9D;UACA,IAAI,CAACT,YAAY,CAACe,QAAQ,CAACJ,cAAc,CAACK,IAAI,CAAC,EAAE;YAC/CvB,KAAK,CAACc,KAAK,CAAC,+DAA+D,CAAC;YAC5EL,QAAQ,CAAC,eAAe,CAAC;YACzB;UACF;;UAEA;UACA,IAAIS,cAAc,CAACM,GAAG,GAAG,IAAI,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;YAC1C1B,KAAK,CAACc,KAAK,CAAC,gDAAgD,CAAC;YAC7DF,YAAY,CAACe,UAAU,CAAC,OAAO,CAAC;YAChClB,QAAQ,CAAC,QAAQ,CAAC;YAClB;UACF;QACF,CAAC,CAAC,OAAOK,KAAK,EAAE;UACdc,OAAO,CAACd,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;UAC/Cd,KAAK,CAACc,KAAK,CAAC,4CAA4C,CAAC;UACzDF,YAAY,CAACe,UAAU,CAAC,OAAO,CAAC;UAChClB,QAAQ,CAAC,QAAQ,CAAC;UAClB;QACF;MACF;IACF,CAAC;IAEDC,cAAc,CAAC,CAAC;EAClB,CAAC,EAAE,CAACD,QAAQ,EAAEF,YAAY,CAAC,CAAC;EAE5B,oBAAOH,OAAA,CAAAF,SAAA;IAAAI,QAAA,EAAGA;EAAQ,gBAAG,CAAC;AACxB,CAAC;AAACE,EAAA,CA/CIH,WAAuC;EAAA,QAC1BN,WAAW;AAAA;AAAA8B,EAAA,GADxBxB,WAAuC;AAiD7C,eAAeA,WAAW;AAAC,IAAAwB,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}